<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>COP 통계</title>
  <link rel="stylesheet" href="/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/cop.css">
</head>
<body style='padding:10px;'>

  <h1>COP 통계</h1>

  <div id="Contents" v-show='!IsLoading'>

    <table class='table table-striped table-bordered table-hover table-condensed'>
    <thead>
    <tr>
      <th>학과명</th>
      <th v-for="(d, i) in Selection">{{d.SelectionName}}</th>
    </tr>
    </thead>
    <tbody>
    <tr v-for='(dr, i) in Major'>
      <th>{{dr.MajorName}}</th>
      <td v-for="(d, i) in Selection">{{GetRegist(d.SelectionId, dr.MajorId).length}}</td>
    </tr>
    </tbody>
    </table>

  </div>
  <script src="/js/vue.js"></script>
  <script src="/js/axios.min.js"></script>
  <script>
  var appVue = new Vue({
    el : "#Contents",
    data : {
      text : "Hellow World",
      IsLoading : true,
      StatisticsData : []
    },
    created : function(){
      var that = this;
      axios.get('http://localhost:3000/Statistics/ka3794', { params: { ID: 12345 } })
        .then(function (response) {
          that.StatisticsData = response.data;
          that.IsLoading = false;
        })
        .catch(function (error) {
          console.log(error);
        })
        .then(function () { // finally
        });
    },
    computed : {
      Selection : function(){
        if(this.StatisticsData.length == 0) return [];
        var data = this.StatisticsData[0];
        return data;
      },
      Major : function(){
        if(this.StatisticsData.length == 0) return [];
        var data = this.StatisticsData[1];
        return data;
      },
      
      RegistData : function(){
        if(this.StatisticsData.length == 0) return [];
        return this.StatisticsData[2].reduce(function(ac, dr, index, arr){
          var SelectionId = dr.SelectionId, MajorId = dr.MajorId;
          if(ac[SelectionId] === undefined) ac[SelectionId] = {};
          if(ac[SelectionId][MajorId] === undefined) ac[SelectionId][MajorId] = [];
          ac[SelectionId][MajorId].push(dr);
          return ac;
        }, {});
      },
    },
    methods : {
      GetRegist : function(SelectionId, MajorId){
        if(this.StatisticsData.length == 0) return [];

        // if(this.RegistData[SelectionId] === undefined) return [];
        // return this.RegistData[SelectionId][MajorId] || [];
        return this.RegistData[SelectionId] && this.RegistData[SelectionId][MajorId] || [];
        // var data = this.RegistData[SelectionId] && this.RegistData[SelectionId][MajorId] || [];
        // return data.length;

        // return this.StatisticsData[2].filter(function(dr){
        //   return dr.SelectionId == SelectionId && dr.MajorId == MajorId
        // }).length;
      }
    }
  });



  </script>
</body>
</html>